# 代码生成执行规范测试用例（单表）

> 目标：验证单表 DDL → Spec → 模板渲染（Vue2）全流程。
> 规范：表结构遵循《数据库设计规范》。

## 1. SQL（DDL + 字典）

```sql
CREATE TABLE `cli_products` (
  `id` varchar(32) NOT NULL COMMENT '主键ID',
  `del_flag` varchar(1) DEFAULT '0' COMMENT '删除状态 0=未删除 1=已删除',
  `create_by` varchar(32) DEFAULT NULL COMMENT '创建人',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP not null COMMENT '创建时间',
  `update_by` varchar(32) DEFAULT NULL COMMENT '更新人',
  `update_time` datetime DEFAULT NULL COMMENT '更新时间',

  `product_code` varchar(64) NOT NULL COMMENT '产品编码',
  `product_name` varchar(120) NOT NULL COMMENT '产品名称',
  `product_status` varchar(1) DEFAULT NULL COMMENT '产品状态：0=停用；1=启用。字典：cli_product_status',
  `product_type` varchar(2) DEFAULT NULL COMMENT '产品类型：01=标准；02=定制。字典：cli_product_type',
  `owner_user_id` varchar(32) DEFAULT NULL COMMENT '负责人用户ID(关联 sys_user 表)',
  `dept_id` varchar(32) DEFAULT NULL COMMENT '所属部门ID(关联 sys_depart 表)',
  `price` decimal(10,2) DEFAULT '0.00' COMMENT '单价',
  `sale_date` date DEFAULT NULL COMMENT '上架日期',
  `is_hot` tinyint(1) DEFAULT 0 COMMENT '是否热卖 0=否 1=是',
  `manual_file` varchar(255) DEFAULT NULL COMMENT '说明书文件',
  `preview_image` varchar(255) DEFAULT NULL COMMENT '预览图片',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `sort_order` int DEFAULT 0 COMMENT '排序',

  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_cli_products_code` (`product_code`),
  KEY `idx_cli_products_status` (`product_status`),
  KEY `idx_cli_products_type` (`product_type`),
  KEY `idx_cli_products_owner_user_id` (`owner_user_id`),
  KEY `idx_cli_products_dept_id` (`dept_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='CLI产品测试表';

-- 字典：cli_product_status
SET @dict_product_status_id = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict` (`id`, `dict_code`, `dict_name`, `description`, `del_flag`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@dict_product_status_id, 'cli_product_status', '产品状态字典', '产品状态字典', '0', 'admin', NOW(), 'admin', NOW());
SET @item_product_status_0 = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict_item` (`id`, `dict_id`, `item_text`, `item_value`, `item_color`, `description`, `sort_order`, `status`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@item_product_status_0, @dict_product_status_id, '停用', '0', null, '停用', 1, 1, 'admin', NOW(), 'admin', NOW());
SET @item_product_status_1 = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict_item` (`id`, `dict_id`, `item_text`, `item_value`, `item_color`, `description`, `sort_order`, `status`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@item_product_status_1, @dict_product_status_id, '启用', '1', null, '启用', 2, 1, 'admin', NOW(), 'admin', NOW());

-- 字典：cli_product_type
SET @dict_product_type_id = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict` (`id`, `dict_code`, `dict_name`, `description`, `del_flag`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@dict_product_type_id, 'cli_product_type', '产品类型字典', '产品类型字典', '0', 'admin', NOW(), 'admin', NOW());
SET @item_product_type_01 = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict_item` (`id`, `dict_id`, `item_text`, `item_value`, `item_color`, `description`, `sort_order`, `status`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@item_product_type_01, @dict_product_type_id, '标准', '01', null, '标准', 1, 1, 'admin', NOW(), 'admin', NOW());
SET @item_product_type_02 = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict_item` (`id`, `dict_id`, `item_text`, `item_value`, `item_color`, `description`, `sort_order`, `status`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@item_product_type_02, @dict_product_type_id, '定制', '02', null, '定制', 2, 1, 'admin', NOW(), 'admin', NOW());

```

## 2. CLI 执行指令（单表 / Vue2）

```bash
# 0) 若 CLI jar 不存在，先构建
# 在 jeecg-boot/ 目录内执行
mvn -pl jeecg-codegen-cli -am clean package

# 1) DDL → spec
java -jar jeecg-boot/jeecg-codegen-cli/target/jeecg-codegen-cli-3.6.3-jar-with-dependencies.jar \
  --ddl specs/cli_products.sql \
  --spec-out specs/cli_products.yaml \
  --output jeecg-boot/jeecg-module-system/jeecg-system-biz \
  --frontend-root ant-design-vue-jeecg/src/views \
  --jsp-mode one \
  --vue-style vue \
  --bussi-package org.jeecg.modules \
  --entity-package cli

# 2) spec → dry-run（可选，不落盘，仅输出清单）
java -jar jeecg-boot/jeecg-codegen-cli/target/jeecg-codegen-cli-3.6.3-jar-with-dependencies.jar \
  --input specs/cli_products.yaml \
  --output jeecg-boot/jeecg-module-system/jeecg-system-biz \
  --frontend-root ant-design-vue-jeecg/src/views \
  --vue-style vue \
  --dry-run

# 3) spec → 模板渲染
java -jar jeecg-boot/jeecg-codegen-cli/target/jeecg-codegen-cli-3.6.3-jar-with-dependencies.jar \
  --input specs/cli_products.yaml \
  --output jeecg-boot/jeecg-module-system/jeecg-system-biz \
  --frontend-root ant-design-vue-jeecg/src/views \
  --vue-style vue
```

## 3. Spec 手工覆盖（业务控件增强）

> DDL 默认不会推断 `sel_user/sel_depart`，需要在 spec 中手动指定。

```yaml
# cli_products.yaml 片段
columns:
  - fieldDbName: owner_user_id
    fieldName: ownerUserId
    classType: sel_user
    fieldShowType: sel_user
  - fieldDbName: dept_id
    fieldName: deptId
    classType: sel_depart
    fieldShowType: sel_depart
```

## 4. 验收要点
- 生成 Entity/Controller/Service/Mapper/Vue 文件齐全。
- 字段字典 `cli_product_status/cli_product_type` 对应 `@Dict` 与前端下拉组件。
- 金额字段为 `decimal`，日期字段为 `date`，文件/图片字段分别生成上传控件。
- `owner_user_id/dept_id` 分别生成 `sel_user/sel_depart` 控件（基于手工 spec 覆盖）。

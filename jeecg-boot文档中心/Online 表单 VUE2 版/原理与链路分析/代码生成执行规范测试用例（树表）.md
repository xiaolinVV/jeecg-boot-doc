# 代码生成执行规范测试用例（树表）

> 目标：验证树结构 DDL → Spec → 模板渲染（Vue2）全流程。
> 规范：表结构遵循《数据库设计规范》，树表必须包含 parent_id + name/title + has_child/is_leaf。

## 1. SQL（DDL + 字典）

```sql
CREATE TABLE `cli_categories` (
  `id` varchar(32) NOT NULL COMMENT '主键ID',
  `del_flag` varchar(1) DEFAULT '0' COMMENT '删除状态 0=未删除 1=已删除',
  `create_by` varchar(32) DEFAULT NULL COMMENT '创建人',
  `create_time` datetime DEFAULT (now()) not null COMMENT '创建时间',
  `update_by` varchar(32) DEFAULT NULL COMMENT '更新人',
  `update_time` datetime DEFAULT NULL COMMENT '更新时间',

  `parent_id` varchar(32) DEFAULT NULL COMMENT '父级ID',
  `name` varchar(120) NOT NULL COMMENT '分类名称',
  `category_type` varchar(2) DEFAULT NULL COMMENT '分类类型：01=业务；02=系统。字典：cli_category_type',
  `category_status` varchar(1) DEFAULT NULL COMMENT '分类状态：0=停用；1=启用。字典：cli_category_status',
  `has_child` varchar(1) DEFAULT '0' COMMENT '是否有子节点 0=否 1=是',
  `level_num` int DEFAULT 1 COMMENT '层级',
  `path` varchar(500) DEFAULT NULL COMMENT '层级路径',
  `sort_order` int DEFAULT 0 COMMENT '排序',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',

  PRIMARY KEY (`id`),
  KEY `idx_cli_categories_parent_id` (`parent_id`),
  KEY `idx_cli_categories_status` (`category_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='CLI分类树测试表';

-- 字典：cli_category_type
SET @dict_category_type_id = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict` (`id`, `dict_code`, `dict_name`, `description`, `del_flag`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@dict_category_type_id, 'cli_category_type', '分类类型字典', '分类类型字典', '0', 'admin', NOW(), 'admin', NOW());
SET @item_category_type_01 = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict_item` (`id`, `dict_id`, `item_text`, `item_value`, `item_color`, `description`, `sort_order`, `status`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@item_category_type_01, @dict_category_type_id, '业务', '01', null, '业务', 1, 1, 'admin', NOW(), 'admin', NOW());
SET @item_category_type_02 = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict_item` (`id`, `dict_id`, `item_text`, `item_value`, `item_color`, `description`, `sort_order`, `status`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@item_category_type_02, @dict_category_type_id, '系统', '02', null, '系统', 2, 1, 'admin', NOW(), 'admin', NOW());

-- 字典：cli_category_status
SET @dict_category_status_id = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict` (`id`, `dict_code`, `dict_name`, `description`, `del_flag`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@dict_category_status_id, 'cli_category_status', '分类状态字典', '分类状态字典', '0', 'admin', NOW(), 'admin', NOW());
SET @item_category_status_0 = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict_item` (`id`, `dict_id`, `item_text`, `item_value`, `item_color`, `description`, `sort_order`, `status`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@item_category_status_0, @dict_category_status_id, '停用', '0', null, '停用', 1, 1, 'admin', NOW(), 'admin', NOW());
SET @item_category_status_1 = REPLACE(UUID(), '-', '');
INSERT INTO `sys_dict_item` (`id`, `dict_id`, `item_text`, `item_value`, `item_color`, `description`, `sort_order`, `status`, `create_by`, `create_time`, `update_by`, `update_time`)
VALUES (@item_category_status_1, @dict_category_status_id, '启用', '1', null, '启用', 2, 1, 'admin', NOW(), 'admin', NOW());
```

## 2. CLI 执行指令（树表 / Vue2）

```bash
# 0) 若 CLI jar 不存在，先构建
# 在 jeecg-boot/ 目录内执行
mvn -pl jeecg-codegen-cli -am clean package

# 1) DDL → spec
java -jar jeecg-boot/jeecg-codegen-cli/target/jeecg-codegen-cli-3.6.3-jar-with-dependencies.jar \
  --ddl specs/cli_categories.sql \
  --spec-out specs/cli_categories.yaml \
  --output jeecg-boot/jeecg-module-system/jeecg-system-biz \
  --frontend-root ant-design-vue-jeecg/src/views \
  --jsp-mode tree \
  --vue-style vue \
  --bussi-package org.jeecg.modules \
  --entity-package cli

# 2) spec → dry-run（可选，不落盘，仅输出清单）
java -jar jeecg-boot/jeecg-codegen-cli/target/jeecg-codegen-cli-3.6.3-jar-with-dependencies.jar \
  --input specs/cli_categories.yaml \
  --output jeecg-boot/jeecg-module-system/jeecg-system-biz \
  --frontend-root ant-design-vue-jeecg/src/views \
  --vue-style vue \
  --dry-run

# 3) spec → 模板渲染
java -jar jeecg-boot/jeecg-codegen-cli/target/jeecg-codegen-cli-3.6.3-jar-with-dependencies.jar \
  --input specs/cli_categories.yaml \
  --output jeecg-boot/jeecg-module-system/jeecg-system-biz \
  --frontend-root ant-design-vue-jeecg/src/views \
  --vue-style vue
```

## 3. 验收要点
- Spec 中 `table.extendParams.pidField=textField/hasChildren` 正确生成。
- 生成的 Vue 列表为树形列表模板（`default.tree`）。
